# Project Memory — CSV Detox

Single source of truth for project state. Update after every meaningful change.

## Current task
- Active spec: None (spec 002 completed)
- Next action: Integration tests for Convex mutations can be added in future spec

## Recent changes (2026-02-02)

### Spec 001: File Upload (Done)
- ✅ Created Convex + Postgres file upload system
- ✅ File IDs generated by database
- ✅ Files stored in Convex storage
- ✅ Updated Next.js to 15.5.11 (security fix)
- ✅ Removed Vite/Vitest references from docs

### Spec 002: Automated Testing (Done)
- ✅ Set up Node.js test runner with tsx
- ✅ Added test scripts: `npm test` and `npm run test:watch`
- ✅ Extracted validation functions to `src/lib/validation.ts`
- ✅ Wrote 26 unit tests for all validation functions
- ✅ All tests passing (100% pass rate)
- ✅ Fixed bug in `sanitizeFilename` discovered by tests
- ✅ Updated AGENTS.md with test commands
- ✅ Updated PATTERNS.md with testing conventions
- ✅ Build verified after refactoring (no regressions)

## Setup required (first-time)
To run the application:
1. `npx convex dev` - Login/create Convex account, initializes project
2. `npm run dev` - Start Next.js (in separate terminal)
3. Visit http://localhost:3000 to test file uploads

See `docs/internal/CONVEX_SETUP.md` for detailed setup instructions.

## Agent rules (OpenCode)
- Repo rules: AGENTS.md

## Key decisions
- Next.js + Node
- Convex for backend + database + file storage
- Postgres available via Convex integration for future features
- DuckDB planned as data engine for preview/export
- Ask before introducing new libraries or patterns; record in docs/internal/PATTERNS.md
