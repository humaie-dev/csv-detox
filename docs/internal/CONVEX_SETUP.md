# Convex + Postgres Setup Guide

## Setup Instructions

### 1. Install Dependencies
Already completed - Convex has been installed.

### 2. Initialize Convex
Run the following command in your terminal:
```bash
npx convex dev
```

This will:
- Prompt you to login or create a Convex account
- Create a new Convex project
- Generate your `NEXT_PUBLIC_CONVEX_URL`
- Create a `.env.local` file with your Convex URL
- Start the Convex development server

### 3. Configure Postgres Integration in Convex Dashboard

After running `npx convex dev`, you'll need to set up Postgres:

1. Go to your Convex Dashboard: https://dashboard.convex.dev
2. Select your project
3. Navigate to "Settings" → "Integrations"
4. Click "Add Integration" → "Postgres"
5. Enter your Postgres connection details:
   - Host
   - Port
   - Database name
   - Username
   - Password

**Note:** The `uploads` table in our schema will use Convex's built-in document database. The Postgres integration is available for future use when you need relational features.

### 4. Environment Variables

Copy `.env.local.example` to `.env.local` and fill in your Convex URL:
```bash
cp .env.local.example .env.local
```

### 5. Run the Development Server

```bash
# Terminal 1: Run Convex dev server
npx convex dev

# Terminal 2: Run Next.js dev server
npm run dev
```

### 6. Deploy (Production)

```bash
npx convex deploy
npm run build
```

## Schema

The `uploads` table stores file metadata:
- `id`: Auto-generated by Convex
- `originalName`: Original filename from upload
- `sanitizedName`: Sanitized/safe filename
- `size`: File size in bytes
- `mimeType`: MIME type (text/csv or .xlsx)
- `convexStorageId`: Reference to file in Convex storage
- `uploadedAt`: ISO timestamp of upload

## File Storage

Files are stored in Convex's built-in file storage system:
1. Client requests upload URL via `generateUploadUrl` mutation
2. Client uploads file directly to Convex storage
3. Client calls `uploadFile` mutation with storage ID and metadata
4. Mutation saves metadata to database

## Testing

To test the upload feature:
1. Make sure both `npx convex dev` and `npm run dev` are running
2. Open http://localhost:3000
3. Upload a CSV or XLSX file (max 50MB)
4. Verify the file metadata appears on success
5. Check Convex Dashboard to see the database record
